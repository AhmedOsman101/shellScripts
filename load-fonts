#!/usr/bin/env bash
# shellcheck disable=SC2207

set -euo pipefail

ttfDir="/usr/local/share/fonts/TTF"
otfDirs="/usr/local/share/fonts/OTF"

[[ ! -d "${ttfDir}" ]] && sudo mkdir -p "${ttfDir}"

[[ ! -d "${otfDir}" ]] && sudo mkdir -p "${otfDir}"

cd ~/fonts

sudo mv -i ./*.ttf "${ttfDir}" >/dev/null 2>&1 || printf ''
sudo mv -i ./*.otf "${otfDir}" >/dev/null 2>&1 || printf ''

fd . -t d -d 1 | while read -r dir; do
  ttfDirs=($(fd . -e ttf "${dir}" -x dirname {} | no-dups -s))
  sudo mv "${ttfDirs[@]}" -t "${ttfDir}" &&
    log-info "Moved $(echo "${ttfDirs[@]}" | tr " " "\n" | cut -d " " -f 5- | tr "\n" " " | trim)"

  if [[ -d "${dir}" ]]; then
    otfDirs=($(fd . -e otf "${dir}" -x dirname {} | no-dups -s))
    sudo mv "${otfDirs[@]}" -t "${otfDir}" &&
      log-info "Moved $(echo "${otfDirs[@]}" | tr " " "\n" | cut -d " " -f 5- | tr "\n" " " | trim)"
  fi
done

gum spin --title "Caching fonts..." --spinner "dot" -- sudo fc-cache -C -f

log-success "Fonts reloaded succefully!"
