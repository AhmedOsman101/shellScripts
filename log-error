#!/usr/bin/env bash
#
# --- SCRIPT SIGNATURE --- #
#
#  ▄▄▄▄
#  ▀▀██
#    ██       ▄████▄    ▄███▄██             ▄████▄    ██▄████   ██▄████   ▄████▄    ██▄████
#    ██      ██▀  ▀██  ██▀  ▀██            ██▄▄▄▄██   ██▀       ██▀      ██▀  ▀██   ██▀
#    ██      ██    ██  ██    ██   █████    ██▀▀▀▀▀▀   ██        ██       ██    ██   ██
#    ██▄▄▄   ▀██▄▄██▀  ▀██▄▄███            ▀██▄▄▄▄█   ██        ██       ▀██▄▄██▀   ██
#     ▀▀▀▀     ▀▀▀▀     ▄▀▀▀ ██              ▀▀▀▀▀    ▀▀        ▀▀         ▀▀▀▀     ▀▀
#                       ▀████▀▀
#
# --- DESCRIPTION --- #
# Prints error messages in red with a '[ERROR] ' prefix to stderr, signals parent with SIGUSR1, and exits with failure
# --- DEPENDENCIES --- #
# - tput
# - ps
# - xargs
# - kill
# --- END SIGNATURE --- #

set -eo pipefail
trap 'exit 1' SIGUSR1

eval "$(include "lib/helpers.sh")"
eval "$(include "check-deps")"

checkDeps "$0"
# ---  Main script logic --- #
# Print error message in red
printRed "[ERROR] $(input "$@")" 1>&2

if ! isInteractiveShell; then
  # Get parent PID (script that called log-error) and send SIGUSR1
  kill -SIGUSR1 "${PPID}" &>/dev/null || true
  wait "${PPID}" &>/dev/null || true
fi

# Exit with failure code (fallback if signal is ignored)
exit 1
