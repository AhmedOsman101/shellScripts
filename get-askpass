#!/usr/bin/env bash

# --- SCRIPT SIGNATURE --- #
#
#                                                              ▄▄
#                        ██                                    ██
#   ▄███▄██   ▄████▄   ███████              ▄█████▄  ▄▄█████▄  ██ ▄██▀   ██▄███▄    ▄█████▄  ▄▄█████▄  ▄▄█████▄
#  ██▀  ▀██  ██▄▄▄▄██    ██                 ▀ ▄▄▄██  ██▄▄▄▄ ▀  ██▄██     ██▀  ▀██   ▀ ▄▄▄██  ██▄▄▄▄ ▀  ██▄▄▄▄ ▀
#  ██    ██  ██▀▀▀▀▀▀    ██       █████    ▄██▀▀▀██   ▀▀▀▀██▄  ██▀██▄    ██    ██  ▄██▀▀▀██   ▀▀▀▀██▄   ▀▀▀▀██▄
#  ▀██▄▄███  ▀██▄▄▄▄█    ██▄▄▄             ██▄▄▄███  █▄▄▄▄▄██  ██  ▀█▄   ███▄▄██▀  ██▄▄▄███  █▄▄▄▄▄██  █▄▄▄▄▄██
#   ▄▀▀▀ ██    ▀▀▀▀▀      ▀▀▀▀              ▀▀▀▀ ▀▀   ▀▀▀▀▀▀   ▀▀   ▀▀▀  ██ ▀▀▀     ▀▀▀▀ ▀▀   ▀▀▀▀▀▀    ▀▀▀▀▀▀
#   ▀████▀▀                                                              ██
#
# --- DESCRIPTION --- #
#
# --- DEPENDENCIES --- #
#
# --- END SIGNATURE --- #

set -eo pipefail

trap 'exit 1' SIGUSR1

source check-deps
checkDeps "$0"
# ---  Main script logic --- #

askpass=""

# Check if running in a graphical environment
if [[ -n "${DISPLAY}" || -n "${WAYLAND_DISPLAY}" ]]; then
  # Check for rofi-askpass
  if command -v rofi-askpass >/dev/null 2>&1; then
    askpass="$(command -v rofi-askpass)"
  # Check for zenity
  elif command -v zenity >/dev/null 2>&1; then
    askpass="zenity --password --title='Authentication Required' --timeout=30"
  # Check for kdialog
  elif command -v kdialog >/dev/null 2>&1; then
    askpass="kdialog --password 'Authentication Required'"
  # Check for yad (zenity fork)
  elif command -v yad >/dev/null 2>&1; then
    askpass="yad --entry --hide-text --title='Authentication Required' --button=OK:0 --timeout=30 --width=300 --height=150 --center"
  # Check for ssh-askpass (common in some X11 setups)
  elif command -v ssh-askpass >/dev/null 2>&1; then
    askpass="$(command -v ssh-askpass)"
  # Check for x11-ssh-askpass (alternative askpass tool)
  elif command -v x11-ssh-askpass >/dev/null 2>&1; then
    askpass="$(command -v x11-ssh-askpass)"
  else
    # Fallback for non-graphical environments (e.g., terminal prompt)
    askpass="/bin/cat"
  fi
else
  # Fallback for non-graphical environments (e.g., terminal prompt)
  askpass="/bin/cat"
fi

printf '%s' "${askpass}"
