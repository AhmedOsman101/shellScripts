#!/usr/bin/env bash
#
# --- SCRIPT SIGNATURE --- #
#
#                            ▄▄                                          ▄▄           ██
#                            ██              ██                          ██           ▀▀
#  ██    ██  ██▄███▄    ▄███▄██   ▄█████▄  ███████    ▄████▄             ██▄███▄    ████      ▄████▄   ████▄██▄   ▄████▄
#  ██    ██  ██▀  ▀██  ██▀  ▀██   ▀ ▄▄▄██    ██      ██▄▄▄▄██            ██▀  ▀██     ██     ██▀  ▀██  ██ ██ ██  ██▄▄▄▄██
#  ██    ██  ██    ██  ██    ██  ▄██▀▀▀██    ██      ██▀▀▀▀▀▀   █████    ██    ██     ██     ██    ██  ██ ██ ██  ██▀▀▀▀▀▀
#  ██▄▄▄███  ███▄▄██▀  ▀██▄▄███  ██▄▄▄███    ██▄▄▄   ▀██▄▄▄▄█            ███▄▄██▀  ▄▄▄██▄▄▄  ▀██▄▄██▀  ██ ██ ██  ▀██▄▄▄▄█
#   ▀▀▀▀ ▀▀  ██ ▀▀▀      ▀▀▀ ▀▀   ▀▀▀▀ ▀▀     ▀▀▀▀     ▀▀▀▀▀             ▀▀ ▀▀▀    ▀▀▀▀▀▀▀▀    ▀▀▀▀    ▀▀ ▀▀ ▀▀    ▀▀▀▀▀
#            ██
#
# --- DESCRIPTION --- #
# Downloads the desired version of Biome and installs it on the user's system
# --- DEPENDENCIES --- #
# - wget
# --- END SIGNATURE --- #

set -eo pipefail
trap 'exit 1' SIGUSR1

eval "$(include "lib/cmdarg.sh")"
eval "$(include "check-deps")"

checkDeps "$0"
cmdarg_info "header" "$(get-desc "$0")"
# ---  Main script logic --- #
cmdarg_parse "$@"

version="${argv[0]}"
[[ -z "${version}" ]] && log-error "No valid version was provided!"

tempPath="/tmp/biome-download-${version}"
regex="${version}\$"

if [[ ! -f "${tempPath}" || ! "${tempPath}" =~ ${regex} ]]; then
  wget -O "${tempPath}" \
    "https://github.com/biomejs/biome/releases/download/%40biomejs%2Fbiome%40${version}/biome-linux-x64"
fi

chmod +x "${tempPath}"

if command -v biome &>/dev/null; then
  sudo mv -iv "${tempPath}" "$(command -v biome)"
else
  sudo mv -v "${tempPath}" '/usr/bin/biome'
fi
